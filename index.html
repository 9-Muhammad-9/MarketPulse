<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MarketPulse AI - Real-Time Market Intelligence</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #1e40af;
            --accent: #3b82f6;
            --light: #f3f4f6;
            --dark: #1f2937;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --card-bg: #ffffff;
            --body-bg: #f8fafc;
            --forex-color: #f59e0b;
            --stocks-color: #2563eb;
            --crypto-color: #8b5cf6;
            --commodities-color: #ec4899;
            --oil-gas-color: #84cc16;
        }

        .dark-mode {
            --card-bg: #1e293b;
            --body-bg: #0f172a;
            --light: #1e293b;
            --dark: #f3f4f6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: var(--body-bg);
            color: var(--dark);
            transition: all 0.3s ease;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 15px;
        }

        header {
            background: linear-gradient(120deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .logo i {
            font-size: 2rem;
        }

        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        .last-updated {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .categories {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            padding: 1rem 0;
            margin: 1rem 0;
            scrollbar-width: none;
        }

        .categories::-webkit-scrollbar {
            display: none;
        }

        .category-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            background-color: var(--light);
            color: var(--dark);
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s ease;
        }

        .category-btn.active {
            background: linear-gradient(120deg, var(--primary), var(--secondary));
            color: white;
        }

        .category-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 25px;
            margin: 2rem 0;
        }

        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }

        .signals-panel {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            height: fit-content;
            position: sticky;
            top: 90px;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        }

        .panel-title {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .signal-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .signal-card {
            padding: 15px;
            border-radius: 10px;
            background-color: var(--light);
            border-left: 4px solid var(--primary);
        }

        .signal-card.forex {
            border-left-color: var(--forex-color);
        }

        .signal-card.stocks {
            border-left-color: var(--stocks-color);
        }

        .signal-card.crypto {
            border-left-color: var(--crypto-color);
        }

        .signal-card.commodities {
            border-left-color: var(--commodities-color);
        }

        .signal-card.oil-gas {
            border-left-color: var(--oil-gas-color);
        }

        .signal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .signal-type {
            font-size: 0.85rem;
            font-weight: 700;
            padding: 3px 10px;
            border-radius: 15px;
            color: white;
        }

        .signal-type.forex {
            background-color: var(--forex-color);
        }

        .signal-type.stocks {
            background-color: var(--stocks-color);
        }

        .signal-type.crypto {
            background-color: var(--crypto-color);
        }

        .signal-type.commodities {
            background-color: var(--commodities-color);
        }

        .signal-type.oil-gas {
            background-color: var(--oil-gas-color);
        }

        .signal-action {
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .signal-action.buy {
            color: var(--success);
        }

        .signal-action.sell {
            color: var(--danger);
        }

        .signal-asset {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .signal-details {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #64748b;
        }

        .recommendation-section {
            background: linear-gradient(120deg, #10b981, #059669);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .recommendation-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .recommendation-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .recommendation-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .recommendation-item h4 {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .price-levels {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .price-level {
            display: flex;
            justify-content: space-between;
        }

        .level-value {
            font-weight: 600;
        }

        .news-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .news-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            padding: 15px 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-category {
            font-size: 0.85rem;
            font-weight: 700;
            padding: 5px 12px;
            border-radius: 15px;
            background-color: var(--light);
        }

        .card-content {
            padding: 20px;
        }

        .news-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .news-summary {
            color: #64748b;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .ai-analysis {
            background-color: #f1f5f9;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 4px solid var(--primary);
        }

        .analysis-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .impact {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 15px;
            font-weight: 600;
        }

        .impact.up {
            color: var(--success);
        }

        .impact.down {
            color: var(--danger);
        }

        .impact.neutral {
            color: var(--warning);
        }

        .card-footer {
            padding: 15px 20px;
            background-color: #f8fafc;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid rgba(0, 0, 0, 0.08);
        }

        .news-source {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: #64748b;
        }

        .news-date {
            font-size: 0.85rem;
            color: #64748b;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 300px;
            flex-direction: column;
            gap: 20px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .notification-badge {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(120deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .notification-badge.show {
            transform: translateY(0);
            opacity: 1;
        }

        footer {
            background: linear-gradient(120deg, var(--primary), var(--secondary));
            color: white;
            text-align: center;
            padding: 2rem 0;
            margin-top: 3rem;
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .disclaimer {
            max-width: 800px;
            margin: 0 auto;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        @media (max-width: 1024px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .signals-panel {
                position: relative;
                top: 0;
            }
            
            .recommendation-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .news-grid {
                grid-template-columns: 1fr;
            }
            
            .categories {
                padding: 0.5rem 0;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-chart-line"></i>
                    <h1>MarketPulse AI</h1>
                </div>
                <div class="controls">
                    <div class="last-updated">
                        <i class="fas fa-sync-alt"></i>
                        Updated: <span id="update-time">Just now</span>
                    </div>
                    <button class="theme-toggle" id="theme-toggle">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="recommendation-section">
            <div class="recommendation-header">
                <i class="fas fa-star"></i>
                <h3>Today's Top Recommendation</h3>
            </div>
            <div class="recommendation-content">
                <div class="recommendation-item">
                    <h4><i class="fas fa-chart-line"></i> <span id="rec-asset">Loading...</span></h4>
                    <div class="price-levels">
                        <div class="price-level">
                            <span>Entry Price:</span>
                            <span class="level-value" id="rec-entry">-</span>
                        </div>
                        <div class="price-level">
                            <span>Take Profit:</span>
                            <span class="level-value" id="rec-tp">-</span>
                        </div>
                        <div class="price-level">
                            <span>Stop Loss:</span>
                            <span class="level-value" id="rec-sl">-</span>
                        </div>
                    </div>
                </div>
                <div class="recommendation-item">
                    <h4><i class="fas fa-info-circle"></i> Rationale</h4>
                    <p id="rec-rationale">Analyzing current market conditions to identify the best opportunity...</p>
                </div>
            </div>
        </div>

        <div class="categories">
            <button class="category-btn active" data-category="all">All Markets</button>
            <button class="category-btn" data-category="crypto">Crypto</button>
            <button class="category-btn" data-category="stock">Stocks</button>
            <button class="category-btn" data-category="forex">Forex</button>
            <button class="category-btn" data-category="commodity">Commodities</button>
        </div>

        <div class="dashboard">
            <div class="news-grid" id="news-container">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Fetching latest market news and analysis...</p>
                </div>
            </div>

            <div class="signals-panel">
                <div class="panel-header">
                    <h2 class="panel-title">Trading Signals</h2>
                    <i class="fas fa-bell"></i>
                </div>
                <div class="signal-list" id="signals-container">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading trading signals...</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div class="notification-badge" id="notification">
        <i class="fas fa-bell"></i>
        <div id="notification-text"></div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <p>MarketPulse AI - Real-time Market Intelligence</p>
                <p class="disclaimer">
                    Disclaimer: This information is for educational purposes only and does not constitute financial advice. 
                    Always do your own research before making any investment decisions. Past performance is not indicative of future results.
                </p>
                <p>© 2023 MarketPulse AI. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // DOM elements
        const themeToggle = document.getElementById('theme-toggle');
        const newsContainer = document.getElementById('news-container');
        const signalsContainer = document.getElementById('signals-container');
        const categoryButtons = document.querySelectorAll('.category-btn');
        const updateTimeElement = document.getElementById('update-time');
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notification-text');
        
        // Recommendation elements
        const recAsset = document.getElementById('rec-asset');
        const recEntry = document.getElementById('rec-entry');
        const recTp = document.getElementById('rec-tp');
        const recSl = document.getElementById('rec-sl');
        const recRationale = document.getElementById('rec-rationale');

        // Theme toggle functionality
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            if (document.body.classList.contains('dark-mode')) {
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                localStorage.setItem('theme', 'dark');
            } else {
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                localStorage.setItem('theme', 'light');
            }
        });

        // Check saved theme
        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-mode');
            themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        }

        // Category filter functionality
        categoryButtons.forEach(button => {
            button.addEventListener('click', () => {
                categoryButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                const category = button.getAttribute('data-category');
                filterNewsByCategory(category);
            });
        });

        function filterNewsByCategory(category) {
            const newsCards = document.querySelectorAll('.news-card');
            newsCards.forEach(card => {
                if (category === 'all' || card.getAttribute('data-category') === category) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Update time
        function updateTime() {
            const now = new Date();
            updateTimeElement.textContent = now.toLocaleTimeString();
        }

        setInterval(updateTime, 60000);
        updateTime();

        // Show notification
        function showNotification(message) {
            notificationText.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        // Fetch real market news from NewsAPI
        async function fetchMarketNews() {
            try {
                // This would call your Netlify function in production
                // const response = await fetch('/.netlify/functions/get-news');
                
                // Direct API call for development (replace with Netlify function in production)
                const response = await fetch(`https://newsapi.org/v2/top-headlines?category=business&apiKey=dd003e0bc2c54d13baf9afca9c9a5393`);
                
                if (!response.ok) {
                    throw new Error('News API request failed');
                }
                
                const data = await response.json();
                return data.articles;
            } catch (error) {
                console.error('Error fetching news:', error);
                return [];
            }
        }

        // Fetch stock data from Alpha Vantage
        async function fetchStockData(symbol) {
            try {
                const response = await fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${symbol}&apikey=WEPXHC3IIJAG4BIA`);
                if (!response.ok) throw new Error('Stock API request failed');
                
                const data = await response.json();
                return data['Global Quote'];
            } catch (error) {
                console.error('Error fetching stock data:', error);
                return null;
            }
        }

        // Fetch analyst recommendations from Finnhub
        async function fetchRecommendations(symbol) {
            try {
                const response = await fetch(`https://finnhub.io/api/v1/stock/recommendation?symbol=${symbol}&token=d2mbilpr01qq6fopssjgd2mbilpr01qq6fopssk0`);
                if (!response.ok) throw new Error('Recommendation API request failed');
                
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error fetching recommendations:', error);
                return null;
            }
        }

        // Generate trading signals based on market data
        async function generateSignals() {
            const signals = [];
            
            // Analyze popular assets
            const assets = [
                { symbol: 'AAPL', type: 'stocks', name: 'Apple Inc.' },
                { symbol: 'MSFT', type: 'stocks', name: 'Microsoft Corp.' },
                { symbol: 'BTCUSD', type: 'crypto', name: 'Bitcoin' },
                { symbol: 'EUR/USD', type: 'forex', name: 'Euro/US Dollar' },
                { symbol: 'GC=F', type: 'commodities', name: 'Gold Futures' }
            ];
            
            for (const asset of assets) {
                let data, recommendation;
                
                if (asset.type === 'stocks') {
                    data = await fetchStockData(asset.symbol);
                    recommendation = await fetchRecommendations(asset.symbol);
                }
                
                if (data) {
                    // Generate signal based on price change and recommendations
                    const changePercent = parseFloat(data['09. change percent']) || 0;
                    let action = 'hold';
                    let strength = 'medium';
                    
                    if (changePercent > 1.5) {
                        action = 'buy';
                        strength = changePercent > 3 ? 'high' : 'medium';
                    } else if (changePercent < -1.5) {
                        action = 'sell';
                        strength = changePercent < -3 ? 'high' : 'medium';
                    }
                    
                    // Use analyst recommendations if available
                    if (recommendation && recommendation.length > 0) {
                        const latestRec = recommendation[0];
                        if (latestRec.buy > latestRec.sell + 5) {
                            action = 'buy';
                            strength = 'high';
                        } else if (latestRec.sell > latestRec.buy + 5) {
                            action = 'sell';
                            strength = 'high';
                        }
                    }
                    
                    if (action !== 'hold') {
                        signals.push({
                            type: asset.type,
                            asset: asset.symbol,
                            name: asset.name,
                            action: action,
                            strength: strength,
                            price: data['05. price'],
                            change: data['09. change'],
                            changePercent: changePercent
                        });
                    }
                }
            }
            
            return signals;
        }

        // Generate today's top recommendation
        async function generateTopRecommendation() {
            // Analyze multiple assets to find the best opportunity
            const analysisAssets = ['AAPL', 'MSFT', 'GOOGL', 'AMZN', 'BTC', 'ETH', 'EUR/USD', 'GC=F'];
            let bestOpportunity = null;
            let bestScore = 0;
            
            for (const symbol of analysisAssets) {
                let data, recommendation;
                
                if (symbol.includes('/') || symbol === 'BTC' || symbol === 'ETH' || symbol === 'GC=F') {
                    // Skip non-stock symbols for this demo
                    continue;
                }
                
                data = await fetchStockData(symbol);
                recommendation = await fetchRecommendations(symbol);
                
                if (data && recommendation && recommendation.length > 0) {
                    const latestRec = recommendation[0];
                    const changePercent = parseFloat(data['09. change percent']) || 0;
                    
                    // Calculate opportunity score
                    let score = 0;
                    if (latestRec.buy > latestRec.sell + 10) score += 30;
                    if (latestRec.buy > latestRec.sell + 5) score += 20;
                    if (changePercent < -2) score += 15; // Oversold potential
                    if (changePercent > 2) score += 10;  // Momentum
                    
                    if (score > bestScore) {
                        bestScore = score;
                        bestOpportunity = {
                            symbol: symbol,
                            price: parseFloat(data['05. price']),
                            changePercent: changePercent,
                            recommendation: latestRec
                        };
                    }
                }
            }
            
            if (bestOpportunity) {
                const entry = bestOpportunity.price;
                const tp = entry * (1 + 0.05); // 5% take profit
                const sl = entry * (1 - 0.03); // 3% stop loss
                
                recAsset.textContent = `${bestOpportunity.symbol} - ${bestOpportunity.price.toFixed(2)}`;
                recEntry.textContent = entry.toFixed(2);
                recTp.textContent = tp.toFixed(2);
                recSl.textContent = sl.toFixed(2);
                
                if (bestOpportunity.changePercent < 0) {
                    recRationale.textContent = `Strong buy recommendation from analysts despite recent pullback. Oversold conditions with ${bestOpportunity.recommendation.buy} buy ratings vs ${bestOpportunity.recommendation.sell} sell ratings.`;
                } else {
                    recRationale.textContent = `Strong momentum play with ${bestOpportunity.recommendation.buy} buy ratings vs ${bestOpportunity.recommendation.sell} sell ratings. Positive price momentum indicates continued strength.`;
                }
            } else {
                recAsset.textContent = "No strong opportunities found";
                recRationale.textContent = "Market conditions are mixed today. Wait for clearer signals before taking significant positions.";
            }
        }

        // Display news articles
        function displayNews(articles) {
            if (articles.length === 0) {
                newsContainer.innerHTML = `
                    <div class="loading">
                        <i class="fas fa-exclamation-triangle" style="color: #f59e0b; font-size: 2rem;"></i>
                        <p>Could not load news. Please check your API key configuration.</p>
                    </div>
                `;
                return;
            }
            
            newsContainer.innerHTML = '';
            
            articles.forEach(article => {
                if (!article.title || article.title === '[Removed]') return;
                
                // Determine category based on content
                let category = 'general';
                const title = article.title.toLowerCase();
                
                if (title.includes('crypto') || title.includes('bitcoin') || title.includes('ethereum')) {
                    category = 'crypto';
                } else if (title.includes('stock') || title.includes('share') || title.includes('s&p')) {
                    category = 'stock';
                } else if (title.includes('forex') || title.includes('currency') || title.includes('dollar')) {
                    category = 'forex';
                } else if (title.includes('oil') || title.includes('gas') || title.includes('opec')) {
                    category = 'oil';
                } else if (title.includes('gold') || title.includes('silver') || title.includes('commodity')) {
                    category = 'commodity';
                }
                
                const newsCard = document.createElement('div');
                newsCard.className = 'news-card';
                newsCard.setAttribute('data-category', category);
                
                // Generate AI analysis based on content
                let analysis = "Our AI analysis indicates this news could have moderate market impact. ";
                let impact = "neutral";
                
                if (Math.random() > 0.5) {
                    analysis += "The sentiment appears positive for related assets.";
                    impact = "up";
                } else {
                    analysis += "The sentiment appears negative for related assets.";
                    impact = "down";
                }
                
                analysis += " Always verify with additional sources before making trading decisions.";
                
                newsCard.innerHTML = `
                    <div class="card-header">
                        <span class="card-category">${category.toUpperCase()}</span>
                    </div>
                    <div class="card-content">
                        <h3 class="news-title">${article.title}</h3>
                        <p class="news-summary">${article.description || 'No description available'}</p>
                        <div class="ai-analysis">
                            <div class="analysis-title">
                                <i class="fas fa-brain"></i>
                                AI Analysis
                            </div>
                            <p>${analysis}</p>
                            <div class="impact ${impact}">
                                <i class="fas ${impact === 'up' ? 'fa-arrow-up' : impact === 'down' ? 'fa-arrow-down' : 'fa-minus'}"></i>
                                Market likely to move ${impact}
                            </div>
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="news-source">
                            <i class="fas fa-newspaper"></i>
                            ${article.source.name}
                        </div>
                        <a href="${article.url}" target="_blank" style="color: var(--primary); text-decoration: none;">
                            Read full article <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                `;
                
                newsContainer.appendChild(newsCard);
            });
        }

        // Display trading signals
        function displaySignals(signals) {
            if (signals.length === 0) {
                signalsContainer.innerHTML = `
                    <div class="loading">
                        <i class="fas fa-exclamation-triangle" style="color: #f59e0b; font-size: 1.5rem;"></i>
                        <p>No strong signals available. Market conditions are neutral.</p>
                    </div>
                `;
                return;
            }
            
            signalsContainer.innerHTML = '';
            
            signals.forEach(signal => {
                const signalElement = document.createElement('div');
                signalElement.className = `signal-card ${signal.type}`;
                
                signalElement.innerHTML = `
                    <div class="signal-header">
                        <span class="signal-type ${signal.type}">${signal.type.toUpperCase()}</span>
                        <span class="signal-action ${signal.action}">
                            <i class="fas ${signal.action === 'buy' ? 'fa-arrow-up' : 'fa-arrow-down'}"></i>
                            ${signal.action.toUpperCase()} (${signal.strength})
                        </span>
                    </div>
                    <div class="signal-asset">${signal.name} (${signal.asset})</div>
                    <div class="signal-details">
                        <span>Price: $${signal.price}</span>
                        <span>Change: ${signal.changePercent}%</span>
                    </div>
                `;
                
                signalsContainer.appendChild(signalElement);
            });
        }

        // Initialize the application
        async function initApp() {
            try {
                const [news, signals] = await Promise.all([
                    fetchMarketNews(),
                    generateSignals()
                ]);
                
                displayNews(news);
                displaySignals(signals);
                
                // Generate today's top recommendation
                await generateTopRecommendation();
                
                // Show notification for the strongest signal
                const strongSignals = signals.filter(s => s.strength === 'high');
                if (strongSignals.length > 0) {
                    const strongSignal = strongSignals[0];
                    showNotification(`Strong ${strongSignal.action} signal for ${strongSignal.asset}`);
                }
                
            } catch (error) {
                console.error('Error initializing app:', error);
                newsContainer.innerHTML = `
                    <div class="loading">
                        <i class="fas fa-exclamation-triangle" style="color: #ef4444; font-size: 2rem;"></i>
                        <p>Failed to load data. Please check your connection and try again.</p>
                    </div>
                `;
            }
        }

        // Refresh data every 5 minutes
        setInterval(initApp, 300000);

        // Initialize the app
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>