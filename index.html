<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MarketPulse AI - Professional Trading Intelligence</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <style>
        :root {
            --primary: #1a365d;
            --secondary: #2a4365;
            --accent: #3182ce;
            --light: #f7fafc;
            --dark: #2d3748;
            --success: #38a169;
            --warning: #d69e2e;
            --danger: #e53e3e;
            --card-bg: #ffffff;
            --body-bg: #edf2f7;
            --sidebar-bg: #1a365d;
            --text-light: #a0aec0;
            --forex-color: #d69e2e;
            --stocks-color: #3182ce;
            --crypto-color: #805ad5;
            --commodities-color: #ed64a6;
            --oil-gas-color: #48bb78;
        }

        .dark-mode {
            --card-bg: #2d3748;
            --body-bg: #1a202c;
            --light: #2d3748;
            --dark: #f7fafc;
            --text-light: #718096;
            --sidebar-bg: #1a202c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: var(--body-bg);
            color: var(--dark);
            transition: all 0.3s ease;
            line-height: 1.6;
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Navigation */
        .sidebar {
            width: 250px;
            background: var(--sidebar-bg);
            color: white;
            padding: 1.5rem 1rem;
            transition: all 0.3s ease;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .sidebar-menu {
            list-style: none;
            margin-bottom: 2rem;
        }

        .sidebar-menu li {
            margin-bottom: 0.5rem;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 0.75rem 1rem;
            color: var(--text-light);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .category-section {
            margin-top: 2rem;
        }

        .category-section h3 {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1rem;
            color: var(--text-light);
        }

        .category-list {
            list-style: none;
        }

        .category-list li {
            margin-bottom: 0.5rem;
        }

        .category-list a {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 0.75rem 1rem;
            color: var(--text-light);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .category-list a:hover, .category-list a.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .category-list a.forex.active { background-color: rgba(214, 158, 46, 0.2); }
        .category-list a.stocks.active { background-color: rgba(49, 130, 206, 0.2); }
        .category-list a.crypto.active { background-color: rgba(128, 90, 213, 0.2); }
        .category-list a.commodities.active { background-color: rgba(237, 100, 166, 0.2); }
        .category-list a.oil-gas.active { background-color: rgba(72, 187, 120, 0.2); }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 2rem;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .header-title h2 {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }

        .header-title p {
            color: var(--text-light);
            margin-top: 0.5rem;
        }

        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .theme-toggle {
            background: var(--light);
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--dark);
            font-size: 1.2rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .last-updated {
            background: var(--light);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        /* News Tabs */
        .news-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            padding-bottom: 1rem;
        }

        .tab-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            background-color: var(--light);
            color: var(--dark);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .tab-btn.active {
            background: linear-gradient(120deg, var(--primary), var(--secondary));
            color: white;
        }

        /* Dashboard Layout */
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 25px;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }

        .video-news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 25px;
        }

        .signals-panel {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            height: fit-content;
            position: sticky;
            top: 90px;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        }

        .panel-title {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .signal-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .signal-card {
            padding: 15px;
            border-radius: 10px;
            background-color: var(--light);
            border-left: 4px solid var(--primary);
        }

        .signal-card.forex {
            border-left-color: var(--forex-color);
        }

        .signal-card.stocks {
            border-left-color: var(--stocks-color);
        }

        .signal-card.crypto {
            border-left-color: var(--crypto-color);
        }

        .signal-card.commodities {
            border-left-color: var(--commodities-color);
        }

        .signal-card.oil-gas {
            border-left-color: var(--oil-gas-color);
        }

        .signal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .signal-type {
            font-size: 0.85rem;
            font-weight: 700;
            padding: 3px 10px;
            border-radius: 15px;
            color: white;
        }

        .signal-type.forex {
            background-color: var(--forex-color);
        }

        .signal-type.stocks {
            background-color: var(--stocks-color);
        }

        .signal-type.crypto {
            background-color: var(--crypto-color);
        }

        .signal-type.commodities {
            background-color: var(--commodities-color);
        }

        .signal-type.oil-gas {
            background-color: var(--oil-gas-color);
        }

        .signal-action {
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .signal-action.buy {
            color: var(--success);
        }

        .signal-action.sell {
            color: var(--danger);
        }

        .signal-asset {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .signal-details {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--text-light);
        }

        /* Recommendation Section */
        .recommendation-section {
            background: linear-gradient(120deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .recommendation-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .recommendation-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .recommendation-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .recommendation-item h4 {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .price-levels {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .price-level {
            display: flex;
            justify-content: space-between;
        }

        .level-value {
            font-weight: 600;
        }

        /* News Cards */
        .news-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .news-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            padding: 15px 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-category {
            font-size: 0.85rem;
            font-weight: 700;
            padding: 5px 12px;
            border-radius: 15px;
            background-color: var(--light);
        }

        .card-content {
            padding: 20px;
        }

        .news-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .news-summary {
            color: var(--text-light);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .ai-analysis {
            background-color: #f1f5f9;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 4px solid var(--primary);
        }

        .analysis-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .impact {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 15px;
            font-weight: 600;
        }

        .impact.up {
            color: var(--success);
        }

        .impact.down {
            color: var(--danger);
        }

        .impact.neutral {
            color: var(--warning);
        }

        .card-footer {
            padding: 15px 20px;
            background-color: var(--light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid rgba(0, 0, 0, 0.08);
        }

        .news-source {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .news-date {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        /* Video Cards */
        .video-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .video-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .video-container {
            position: relative;
            width: 100%;
            height: 200px;
            background-color: #000;
        }

        .video-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .play-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.7);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .video-content {
            padding: 20px;
        }

        .video-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .video-duration {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 10px;
        }

        /* Loading States */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 300px;
            flex-direction: column;
            gap: 20px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Notification */
        .notification-badge {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(120deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .notification-badge.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* Footer */
        footer {
            background: linear-gradient(120deg, var(--primary), var(--secondary));
            color: white;
            text-align: center;
            padding: 2rem;
            margin-top: 3rem;
            border-radius: 12px;
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .disclaimer {
            max-width: 800px;
            margin: 0 auto;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .sidebar {
                width: 200px;
            }
            .main-content {
                margin-left: 200px;
            }
            .dashboard {
                grid-template-columns: 1fr;
            }
            .signals-panel {
                position: relative;
                top: 0;
            }
            .recommendation-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                width: 250px;
            }
            .sidebar.active {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
                padding: 1rem;
            }
            .header {
                flex-direction: column;
                gap: 15px;
            }
            .news-grid, .video-news-grid {
                grid-template-columns: 1fr;
            }
            .menu-toggle {
                display: block;
                position: fixed;
                top: 20px;
                left: 20px;
                z-index: 1100;
                background: var(--primary);
                color: white;
                width: 45px;
                height: 45px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1.2rem;
                cursor: pointer;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            }
        }
    </style>
</head>
<body>
    <!-- Mobile Menu Toggle -->
    <div class="menu-toggle" id="menu-toggle">
        <i class="fas fa-bars"></i>
    </div>

    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <i class="fas fa-chart-line"></i>
            <h1>MarketPulse</h1>
        </div>

        <ul class="sidebar-menu">
            <li><a href="#" class="active"><i class="fas fa-home"></i> Dashboard</a></li>
            <li><a href="#"><i class="fas fa-bell"></i> Notifications</a></li>
            <li><a href="#"><i class="fas fa-star"></i> Watchlist</a></li>
            <li><a href="#"><i class="fas fa-cog"></i> Settings</a></li>
        </ul>

        <div class="category-section">
            <h3>Market Categories</h3>
            <ul class="category-list">
                <li><a href="#" class="active" data-category="all"><i class="fas fa-globe"></i> All Markets</a></li>
                <li><a href="#" data-category="forex"><i class="fas fa-dollar-sign"></i> Forex</a></li>
                <li><a href="#" data-category="stocks"><i class="fas fa-chart-line"></i> Stocks</a></li>
                <li><a href="#" data-category="crypto"><i class="fab fa-bitcoin"></i> Cryptocurrency</a></li>
                <li><a href="#" data-category="commodities"><i class="fas fa-gem"></i> Commodities</a></li>
                <li><a href="#" data-category="oil-gas"><i class="fas fa-gas-pump"></i> Oil & Gas</a></li>
            </ul>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <div class="header">
            <div class="header-title">
                <h2>Market Overview</h2>
                <p>Real-time market intelligence and trading signals</p>
            </div>
            <div class="controls">
                <div class="last-updated">
                    <i class="fas fa-sync-alt"></i>
                    Updated: <span id="update-time">Just now</span>
                </div>
                <button class="theme-toggle" id="theme-toggle">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>

        <!-- Recommendation Section -->
        <div class="recommendation-section">
            <div class="recommendation-header">
                <i class="fas fa-star"></i>
                <h3>Today's Top Recommendation</h3>
            </div>
            <div class="recommendation-content">
                <div class="recommendation-item">
                    <h4><i class="fas fa-chart-line"></i> <span id="rec-asset">Loading...</span></h4>
                    <div class="price-levels">
                        <div class="price-level">
                            <span>Entry Price:</span>
                            <span class="level-value" id="rec-entry">-</span>
                        </div>
                        <div class="price-level">
                            <span>Take Profit:</span>
                            <span class="level-value" id="rec-tp">-</span>
                        </div>
                        <div class="price-level">
                            <span>Stop Loss:</span>
                            <span class="level-value" id="rec-sl">-</span>
                        </div>
                    </div>
                </div>
                <div class="recommendation-item">
                    <h4><i class="fas fa-info-circle"></i> Rationale</h4>
                    <p id="rec-rationale">Analyzing current market conditions to identify the best opportunity...</p>
                </div>
            </div>
        </div>

        <!-- News Tabs -->
        <div class="news-tabs">
            <button class="tab-btn active" data-tab="text-news">Text News</button>
            <button class="tab-btn" data-tab="video-news">Video News</button>
        </div>

        <!-- Dashboard Content -->
        <div class="dashboard">
            <div class="content-container">
                <!-- Text News Section -->
                <div class="content-section active" id="text-news">
                    <div class="news-grid" id="news-container">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Fetching latest market news and analysis...</p>
                        </div>
                    </div>
                </div>

                <!-- Video News Section -->
                <div class="content-section" id="video-news">
                    <div class="video-news-grid" id="video-container">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading market videos...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Signals Panel -->
            <div class="signals-panel">
                <div class="panel-header">
                    <h2 class="panel-title">Trading Signals</h2>
                    <i class="fas fa-bell"></i>
                </div>
                <div class="signal-list" id="signals-container">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading trading signals...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer>
            <div class="footer-content">
                <p>MarketPulse AI - Real-time Market Intelligence</p>
                <p class="disclaimer">
                    Disclaimer: This information is for educational purposes only and does not constitute financial advice. 
                    Always do your own research before making any investment decisions. Past performance is not indicative of future results.
                </p>
                <p>Â© 2023 MarketPulse AI. All rights reserved.</p>
            </div>
        </footer>
    </main>

    <div class="notification-badge" id="notification">
        <i class="fas fa-bell"></i>
        <div id="notification-text"></div>
    </div>

    <script>
        // DOM elements
        const themeToggle = document.getElementById('theme-toggle');
        const newsContainer = document.getElementById('news-container');
        const videoContainer = document.getElementById('video-container');
        const signalsContainer = document.getElementById('signals-container');
        const updateTimeElement = document.getElementById('update-time');
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notification-text');
        const menuToggle = document.getElementById('menu-toggle');
        const sidebar = document.getElementById('sidebar');
        
        // Recommendation elements
        const recAsset = document.getElementById('rec-asset');
        const recEntry = document.getElementById('rec-entry');
        const recTp = document.getElementById('rec-tp');
        const recSl = document.getElementById('rec-sl');
        const recRationale = document.getElementById('rec-rationale');
        
        // Category and tab elements
        const categoryLinks = document.querySelectorAll('.category-list a');
        const tabButtons = document.querySelectorAll('.tab-btn');
        const contentSections = document.querySelectorAll('.content-section');

        // Current state
        let currentCategory = 'all';
        let currentTab = 'text-news';

        // Theme toggle functionality
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            if (document.body.classList.contains('dark-mode')) {
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                localStorage.setItem('theme', 'dark');
            } else {
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                localStorage.setItem('theme', 'light');
            }
        });

        // Check saved theme
        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-mode');
            themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        }

        // Mobile menu toggle
        menuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('active');
        });

        // Category selection
        categoryLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                
                // Update active state
                categoryLinks.forEach(item => item.classList.remove('active'));
                link.classList.add('active');
                
                // Get selected category
                currentCategory = link.getAttribute('data-category');
                
                // Reload data for the selected category
                loadCategoryData(currentCategory);
            });
        });

        // Tab selection
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Update active state
                tabButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                
                // Show selected tab content
                currentTab = button.getAttribute('data-tab');
                contentSections.forEach(section => {
                    section.classList.remove('active');
                    if (section.id === currentTab) {
                        section.classList.add('active');
                    }
                });
                
                // Load data for the selected tab if needed
                if (currentTab === 'video-news' && videoContainer.innerHTML.includes('Loading')) {
                    loadVideoContent(currentCategory);
                }
            });
        });

        // Update time
        function updateTime() {
            const now = new Date();
            updateTimeElement.textContent = now.toLocaleTimeString();
        }

        setInterval(updateTime, 60000);
        updateTime();

        // Show notification
        function showNotification(message) {
            notificationText.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        // Function to fetch data from your Netlify Function
        async function fetchFromAPI(functionName, params = {}) {
            try {
                // Convert params object to a query string
                const queryString = new URLSearchParams(params).toString();
                // This calls YOUR function, e.g., /api/get-news?category=business
                const url = `/api/${functionName}${queryString ? '?' + queryString : ''}`;

                const response = await fetch(url);
                if (!response.ok) throw new Error(`API error: ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error(`Error fetching from ${functionName}:`, error);
                return null;
            }
        }

        // Fetch real market news from NewsAPI via Netlify Function
        async function fetchMarketNews(category = 'business') {
            // This calls your Netlify Function endpoint, not NewsAPI directly
            const newsData = await fetchFromAPI('get-news', { category: category });
            // Check if the response is valid and has articles
            if (newsData && newsData.articles) {
                return newsData.articles;
            } else {
                // This will help with debugging
                console.error("Invalid response structure from Netlify Function:", newsData);
                return [];
            }
        }

        // Fetch stock data from Alpha Vantage via Netlify Function
        async function fetchStockData(symbol) {
            const stockData = await fetchFromAPI('get-stock-data', { symbol: symbol });
            return stockData && stockData['Global Quote'] ? stockData['Global Quote'] : null;
        }

        // Fetch analyst recommendations from Finnhub via Netlify Function
        async function fetchRecommendations(symbol) {
            const recommendations = await fetchFromAPI('get-recommendations', { symbol: symbol });
            return recommendations && recommendations.length > 0 ? recommendations[0] : null;
        }

        // Generate trading signals based on market data
        async function generateSignals() {
            const signals = [];
            
            // Analyze popular assets
            const assets = [
                { symbol: 'AAPL', type: 'stocks', name: 'Apple Inc.' },
                { symbol: 'MSFT', type: 'stocks', name: 'Microsoft Corp.' },
                { symbol: 'GOOGL', type: 'stocks', name: 'Alphabet Inc.' },
                { symbol: 'EUR/USD', type: 'forex', name: 'Euro/US Dollar' },
                { symbol: 'BTC', type: 'crypto', name: 'Bitcoin' }
            ];
            
            for (const asset of assets) {
                let data, recommendation;
                
                if (asset.type === 'stocks') {
                    data = await fetchStockData(asset.symbol);
                    recommendation = await fetchRecommendations(asset.symbol);
                }
                
                if (data) {
                    // Generate signal based on price change and recommendations
                    const changePercent = parseFloat(data['09. change percent']) || 0;
                    let action = 'hold';
                    let strength = 'medium';
                    
                    if (changePercent > 1.5) {
                        action = 'buy';
                        strength = changePercent > 3 ? 'high' : 'medium';
                    } else if (changePercent < -1.5) {
                        action = 'sell';
                        strength = changePercent < -3 ? 'high' : 'medium';
                    }
                    
                    // Use analyst recommendations if available
                    if (recommendation) {
                        if (recommendation.buy > recommendation.sell + 5) {
                            action = 'buy';
                            strength = 'high';
                        } else if (recommendation.sell > recommendation.buy + 5) {
                            action = 'sell';
                            strength = 'high';
                        }
                    }
                    
                    if (action !== 'hold') {
                        signals.push({
                            type: asset.type,
                            asset: asset.symbol,
                            name: asset.name,
                            action: action,
                            strength: strength,
                            price: data['05. price'],
                            change: data['09. change'],
                            changePercent: changePercent
                        });
                    }
                }
            }
            
            return signals;
        }

        // Generate today's top recommendation
        async function generateTopRecommendation() {
            // Analyze multiple assets to find the best opportunity
            const analysisAssets = ['AAPL', 'MSFT', 'GOOGL', 'AMZN'];
            let bestOpportunity = null;
            let bestScore = 0;
            
            for (const symbol of analysisAssets) {
                const data = await fetchStockData(symbol);
                const recommendation = await fetchRecommendations(symbol);
                
                if (data && recommendation) {
                    const changePercent = parseFloat(data['09. change percent']) || 0;
                    
                    // Calculate opportunity score
                    let score = 0;
                    if (recommendation.buy > recommendation.sell + 10) score += 30;
                    if (recommendation.buy > recommendation.sell + 5) score += 20;
                    if (changePercent < -2) score += 15; // Oversold potential
                    if (changePercent > 2) score += 10;  // Momentum
                    
                    if (score > bestScore) {
                        bestScore = score;
                        bestOpportunity = {
                            symbol: symbol,
                            price: parseFloat(data['05. price']),
                            changePercent: changePercent,
                            recommendation: recommendation
                        };
                    }
                }
            }
            
            if (bestOpportunity) {
                const entry = bestOpportunity.price;
                const tp = entry * (1 + 0.05); // 5% take profit
                const sl = entry * (1 - 0.03); // 3% stop loss
                
                recAsset.textContent = `${bestOpportunity.symbol} - ${bestOpportunity.price.toFixed(2)}`;
                recEntry.textContent = entry.toFixed(2);
                recTp.textContent = tp.toFixed(2);
                recSl.textContent = sl.toFixed(2);
                
                if (bestOpportunity.changePercent < 0) {
                    recRationale.textContent = `Strong buy recommendation from analysts despite recent pullback. Oversold conditions with ${bestOpportunity.recommendation.buy} buy ratings vs ${bestOpportunity.recommendation.sell} sell ratings.`;
                } else {
                    recRationale.textContent = `Strong momentum play with ${bestOpportunity.recommendation.buy} buy ratings vs ${bestOpportunity.recommendation.sell} sell ratings. Positive price momentum indicates continued strength.`;
                }
            } else {
                recAsset.textContent = "No strong opportunities found";
                recRationale.textContent = "Market conditions are mixed today. Wait for clearer signals before taking significant positions.";
            }
        }

        // Load video content (simulated for now)
        async function loadVideoContent(category) {
            // In a real implementation, this would fetch videos from an API
            // For now, we'll simulate loading with a timeout
            setTimeout(() => {
                videoContainer.innerHTML = `
                    <div class="video-card">
                        <div class="video-container">
                            <img src="https://i.ytimg.com/vi/6c7k8dT3dSE/hqdefault.jpg" alt="Market Analysis" class="video-thumbnail">
                            <div class="play-button">
                                <i class="fas fa-play"></i>
                            </div>
                        </div>
                        <div class="video-content">
                            <h3 class="video-title">Market Outlook: Fed Decision Impact Analysis</h3>
                            <p class="news-summary">Expert analysis of how the latest Federal Reserve decision will impact various market sectors.</p>
                            <div class="video-duration">
                                <i class="far fa-clock"></i> 15:30
                            </div>
                        </div>
                    </div>
                    <div class="video-card">
                        <div class="video-container">
                            <img src="https://i.ytimg.com/vi/zx6L8Q_sT8I/hqdefault.jpg" alt="Crypto Update" class="video-thumbnail">
                            <div class="play-button">
                                <i class="fas fa-play"></i>
                            </div>
                        </div>
                        <div class="video-content">
                            <h3 class="video-title">Bitcoin Breakout: What's Next for Crypto?</h3>
                            <p class="news-summary">Technical analysis of Bitcoin's recent price movement and predictions for the coming weeks.</p>
                            <div class="video-duration">
                                <i class="far fa-clock"></i> 12:45
                            </div>
                        </div>
                    </div>
                    <div class="video-card">
                        <div class="video-container">
                            <img src="https://i.ytimg.com/vi/6cI5MsR5dPg/hqdefault.jpg" alt="Stock Picks" class="video-thumbnail">
                            <div class="play-button">
                                <i class="fas fa-play"></i>
                            </div>
                        </div>
                        <div class="video-content">
                            <h3 class="video-title">Top 5 Stocks to Watch This Quarter</h3>
                            <p class="news-summary">Our analysts pick the most promising stocks for the current quarter based on fundamentals and technicals.</p>
                            <div class="video-duration">
                                <i class="far fa-clock"></i> 18:20
                            </div>
                        </div>
                    </div>
                `;
            }, 1500);
        }

        // Display news articles
        function displayNews(articles, category = 'all') {
            if (articles.length === 0) {
                newsContainer.innerHTML = `
                    <div class="loading">
                        <i class="fas fa-exclamation-triangle" style="color: #f59e0b; font-size: 2rem;"></i>
                        <p>Could not load news. Please check your API key configuration.</p>
                    </div>
                `;
                return;
            }
            
            newsContainer.innerHTML = '';
            
            articles.forEach(article => {
                if (!article.title || article.title === '[Removed]') return;
                
                // Determine category based on content
                let articleCategory = 'general';
                const title = article.title.toLowerCase();
                
                if (title.includes('crypto') || title.includes('bitcoin') || title.includes('ethereum')) {
                    articleCategory = 'crypto';
                } else if (title.includes('stock') || title.includes('share') || title.includes('s&p')) {
                    articleCategory = 'stocks';
                } else if (title.includes('forex') || title.includes('currency') || title.includes('dollar')) {
                    articleCategory = 'forex';
                } else if (title.includes('oil') || title.includes('gas') || title.includes('opec')) {
                    articleCategory = 'oil-gas';
                } else if (title.includes('gold') || title.includes('silver') || title.includes('commodity')) {
                    articleCategory = 'commodities';
                }
                
                // Skip if not in the selected category
                if (category !== 'all' && articleCategory !== category) return;
                
                const newsCard = document.createElement('div');
                newsCard.className = 'news-card';
                newsCard.setAttribute('data-category', articleCategory);
                
                // Generate AI analysis based on content
                let analysis = "Our AI analysis indicates this news could have moderate market impact. ";
                let impact = "neutral";
                
                if (Math.random() > 0.5) {
                    analysis += "The sentiment appears positive for related assets.";
                    impact = "up";
                } else {
                    analysis += "The sentiment appears negative for related assets.";
                    impact = "down";
                }
                
                analysis += " Always verify with additional sources before making trading decisions.";
                
                newsCard.innerHTML = `
                    <div class="card-header">
                        <span class="card-category">${articleCategory.toUpperCase()}</span>
                    </div>
                    <div class="card-content">
                        <h3 class="news-title">${article.title}</h3>
                        <p class="news-summary">${article.description || 'No description available'}</p>
                        <div class="ai-analysis">
                            <div class="analysis-title">
                                <i class="fas fa-brain"></i>
                                AI Analysis
                            </div>
                            <p>${analysis}</p>
                            <div class="impact ${impact}">
                                <i class="fas ${impact === 'up' ? 'fa-arrow-up' : impact === 'down' ? 'fa-arrow-down' : 'fa-minus'}"></i>
                                Market likely to move ${impact}
                            </div>
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="news-source">
                            <i class="fas fa-newspaper"></i>
                            ${article.source.name}
                        </div>
                        <a href="${article.url}" target="_blank" style="color: var(--primary); text-decoration: none;">
                            Read full article <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                `;
                
                newsContainer.appendChild(newsCard);
            });
            
            if (newsContainer.innerHTML === '') {
                newsContainer.innerHTML = `
                    <div class="loading">
                        <i class="fas fa-info-circle" style="color: #3182ce; font-size: 2rem;"></i>
                        <p>No news found for the selected category.</p>
                    </div>
                `;
            }
        }

        // Display trading signals
        function displaySignals(signals, category = 'all') {
            if (signals.length === 0) {
                signalsContainer.innerHTML = `
                    <div class="loading">
                        <i class="fas fa-exclamation-triangle" style="color: #f59e0b; font-size: 1.5rem;"></i>
                        <p>No strong signals available. Market conditions are neutral.</p>
                    </div>
                `;
                return;
            }
            
            signalsContainer.innerHTML = '';
            
            signals.forEach(signal => {
                // Skip if not in the selected category
                if (category !== 'all' && signal.type !== category) return;
                
                const signalElement = document.createElement('div');
                signalElement.className = `signal-card ${signal.type}`;
                
                signalElement.innerHTML = `
                    <div class="signal-header">
                        <span class="signal-type ${signal.type}">${signal.type.toUpperCase()}</span>
                        <span class="signal-action ${signal.action}">
                            <i class="fas ${signal.action === 'buy' ? 'fa-arrow-up' : 'fa-arrow-down'}"></i>
                            ${signal.action.toUpperCase()} (${signal.strength})
                        </span>
                    </div>
                    <div class="signal-asset">${signal.name} (${signal.asset})</div>
                    <div class="signal-details">
                        <span>Price: $${signal.price}</span>
                        <span>Change: ${signal.changePercent}%</span>
                    </div>
                `;
                
                signalsContainer.appendChild(signalElement);
            });
            
            if (signalsContainer.innerHTML === '') {
                signalsContainer.innerHTML = `
                    <div class="loading">
                        <i class="fas fa-info-circle" style="color: #3182ce; font-size: 1.5rem;"></i>
                        <p>No signals found for the selected category.</p>
                    </div>
                `;
            }
        }

        // Load data for a specific category
        async function loadCategoryData(category) {
            try {
                newsContainer.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading market data...</p></div>';
                signalsContainer.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading signals...</p></div>';
                
                const [news, signals] = await Promise.all([
                    fetchMarketNews(category === 'all' ? 'business' : category),
                    generateSignals()
                ]);
                
                displayNews(news, category);
                displaySignals(signals, category);
                
            } catch (error) {
                console.error('Error loading category data:', error);
                newsContainer.innerHTML = `
                    <div class="loading">
                        <i class="fas fa-exclamation-triangle" style="color: #ef4444; font-size: 2rem;"></i>
                        <p>Failed to load data. Please check your connection and try again.</p>
                    </div>
                `;
            }
        }

        // Initialize the application
        async function initApp() {
            try {
                await loadCategoryData('all');
                await generateTopRecommendation();
                
                // Show notification for the strongest signal
                setTimeout(() => {
                    showNotification("Market data loaded successfully. Check today's top recommendation!");
                }, 2000);
                
            } catch (error) {
                console.error('Error initializing app:', error);
                newsContainer.innerHTML = `
                    <div class="loading">
                        <i class="fas fa-exclamation-triangle" style="color: #ef4444; font-size: 2rem;"></i>
                        <p>Failed to load data. Please check your connection and try again.</p>
                    </div>
                `;
            }
        }

        // Refresh data every 5 minutes
        setInterval(() => {
            loadCategoryData(currentCategory);
        }, 300000);

        // Initialize the app
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>